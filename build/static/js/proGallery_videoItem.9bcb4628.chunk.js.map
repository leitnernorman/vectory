{"version":3,"sources":["../../../src/components/item/videos/videoItem.js","../../../src/components/item/videos/getStyle.js"],"names":["VideoItem","_this","prototype","isCrop","isWiderThenContainer","CALC"],"mappings":"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","file":"static/js/proGallery_videoItem.9bcb4628.chunk.js","sourcesContent":["import { __assign, __extends, __rest } from \"tslib\";\nimport React from 'react';\nimport { GALLERY_CONSTS, window, utils } from 'pro-gallery-lib';\nimport { GalleryComponent } from '../../galleryComponent';\nimport getStyle from './getStyle';\nvar VideoItem = /** @class */ (function (_super) {\n    __extends(VideoItem, _super);\n    function VideoItem(props) {\n        var _this = _super.call(this, props) || this;\n        _this.pause = _this.pause.bind(_this);\n        _this.play = _this.play.bind(_this);\n        _this.playVideoIfNeeded = _this.playVideoIfNeeded.bind(_this);\n        _this.state = {\n            playedOnce: false,\n            loadVideo: props.loadVideo || props.playing,\n            playing: false,\n            reactPlayerLoaded: false,\n            vimeoPlayerLoaded: false,\n            hlsPlayerLoaded: false,\n        };\n        return _this;\n    }\n    VideoItem.prototype.componentDidMount = function () {\n        this.dynamiclyImportVideoPlayers();\n    };\n    VideoItem.prototype.dynamiclyImportVideoPlayers = function () {\n        var _this = this;\n        if (!(window && window.ReactPlayer)) {\n            import(\n            /* webpackChunkName: \"proGallery_reactPlayer\" */ 'react-player').then(function (ReactPlayer) {\n                window.ReactPlayer = ReactPlayer.default;\n                _this.setState({ reactPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n        if (\n        //Vimeo player must be loaded by us, problem with requireJS\n        !(window && window.Vimeo) &&\n            this.props.videoUrl &&\n            this.props.videoUrl.includes('vimeo.com')) {\n            import(\n            /* webpackChunkName: \"proGallery_vimeoPlayer\" */ '@vimeo/player').then(function (Player) {\n                window.Vimeo = { Player: Player.default };\n                _this.setState({ vimeoPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n        if (\n        //Hls player must be loaded by us, problem with requireJS\n        !(window && window.Hls) &&\n            this.isHLSVideo()) {\n            import(/* webpackChunkName: \"proGallery_HlsPlayer\" */ 'hls.js').then(function (Player) {\n                window.Hls = Player.default;\n                _this.setState({ hlsPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n    };\n    VideoItem.prototype.isHLSVideo = function () {\n        return (this.props.videoUrl &&\n            (this.props.videoUrl.includes('/hls') ||\n                this.props.videoUrl.includes('.m3u8')));\n    };\n    VideoItem.prototype.shouldUseHlsPlayer = function () {\n        return this.isHLSVideo() && !utils.isiOS();\n    };\n    VideoItem.prototype.shouldForceVideoForHLS = function () {\n        return this.isHLSVideo() && utils.isiOS();\n    };\n    VideoItem.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n        if (nextProps.playing || nextProps.firstUserInteractionExecuted) {\n            this.setState({ loadVideo: true });\n        }\n        this.playVideoIfNeeded(nextProps);\n    };\n    VideoItem.prototype.componentDidUpdate = function (prevProps) {\n        if (prevProps.currentIdx !== this.props.currentIdx) {\n            this.fixIFrameTabIndexIfNeeded();\n        }\n        if (prevProps.type === 'image' && this.props.type === 'video') {\n            this.dynamiclyImportVideoPlayers();\n        }\n        this.playVideoIfNeeded();\n    };\n    VideoItem.prototype.play = function () {\n        this.props.playVideo(this.props.idx);\n    };\n    VideoItem.prototype.pause = function () {\n        this.props.pauseVideo();\n    };\n    VideoItem.prototype.playVideoIfNeeded = function (props) {\n        if (props === void 0) { props = this.props; }\n        try {\n            var playingVideoIdx = props.playingVideoIdx;\n            if (playingVideoIdx === this.props.idx && !this.isPlaying) {\n                this.videoElement =\n                    this.videoElement ||\n                        window.document.querySelector(\"#video-\" + this.props.id + \" video\");\n                if (this.videoElement) {\n                    this.isPlaying = true;\n                    this.videoElement.play();\n                    utils.isVerbose() &&\n                        console.log('[VIDEO] Playing video #' + this.props.idx, this.videoElement);\n                }\n            }\n        }\n        catch (e) {\n            console.error('[VIDEO] Could not play video #' + this.props.idx, this.videoElement, e);\n        }\n    };\n    //-----------------------------------------| UTILS |--------------------------------------------//\n    VideoItem.prototype.createPlayerElement = function () {\n        var _this = this;\n        //video dimensions are for videos in grid fill - placing the video with negative margins to crop into a square\n        if (!(window &&\n            window.ReactPlayer &&\n            (this.state.loadVideo || this.props.playing))) {\n            return null;\n        }\n        var PlayerElement = window.ReactPlayer;\n        var isWiderThenContainer = this.props.style.ratio >= this.props.cubeRatio;\n        // adding 1 pixel to compensate for the difference we have sometimes from layouter in grid fill\n        var isCrop = this.props.styleParams.cubeImages &&\n            this.props.styleParams.cubeType === 'fill';\n        var url = this.props.videoUrl\n            ? this.props.videoUrl\n            : this.props.createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.VIDEO);\n        return (React.createElement(PlayerElement, { className: 'gallery-item-visible video gallery-item', id: \"video-\" + this.props.id, width: \"100%\", height: \"100%\", url: url, alt: this.props.alt ? this.props.alt : 'untitled video', loop: !!this.props.styleParams.videoLoop, ref: function (player) { return (_this.video = player); }, volume: this.props.styleParams.videoSound ? 0.8 : 0, playing: this.props.playing, onEnded: function () {\n                _this.setState({ playing: false });\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_ENDED, _this.props);\n            }, onPause: function () {\n                _this.setState({ playing: false });\n            }, onError: function (e) {\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_ERROR, __assign(__assign({}, _this.props), { videoError: e }));\n            }, playbackRate: Number(this.props.styleParams.videoSpeed) || 1, onStart: function () {\n                if (!_this.state.playedOnce) {\n                    _this.setState({ playedOnce: true });\n                }\n            }, onPlay: function () {\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_PLAYED, _this.props);\n                _this.setState({ playing: true });\n            }, onReady: function () {\n                _this.playVideoIfNeeded();\n                _this.fixIFrameTabIndexIfNeeded();\n                _this.props.actions.setItemLoaded();\n                _this.setState({ ready: true });\n            }, controls: this.props.styleParams.showVideoControls, config: {\n                file: {\n                    attributes: {\n                        controlsList: 'nodownload',\n                        disablepictureinpicture: 'true',\n                        muted: !this.props.styleParams.videoSound,\n                        preload: 'metadata',\n                        poster: this.props.createUrl(GALLERY_CONSTS.urlSizes.SCALED, GALLERY_CONSTS.urlTypes.HIGH_RES),\n                        style: getStyle(isCrop, isWiderThenContainer),\n                        type: 'video/mp4',\n                    },\n                    forceHLS: this.shouldUseHlsPlayer(),\n                    forceVideo: this.shouldForceVideoForHLS(),\n                },\n            }, key: 'video-' + this.props.id }));\n    };\n    VideoItem.prototype.fixIFrameTabIndexIfNeeded = function () {\n        if (this.props.isExternalVideo) {\n            var videoGalleryItem = window.document &&\n                window.document.getElementById(\"video-\" + this.props.id);\n            var videoIFrames = videoGalleryItem && videoGalleryItem.getElementsByTagName('iframe');\n            var videoIFrame = videoIFrames && videoIFrames[0];\n            if (videoIFrame) {\n                if (this.props.currentIdx === this.props.idx) {\n                    videoIFrame.setAttribute('tabIndex', '0');\n                }\n                else {\n                    videoIFrame.setAttribute('tabIndex', '-1');\n                }\n            }\n        }\n    };\n    //-----------------------------------------| RENDER |--------------------------------------------//\n    VideoItem.prototype.render = function () {\n        var _a = this.props, videoPlaceholder = _a.videoPlaceholder, hover = _a.hover;\n        var baseClassName = 'gallery-item-content gallery-item-visible gallery-item-preloaded gallery-item-video gallery-item video-item' +\n            (utils.isiPhone() ? ' ios' : '');\n        if (this.state.playing) {\n            baseClassName += ' playing';\n        }\n        if (this.state.playedOnce && this.state.ready) {\n            baseClassName += ' playedOnce';\n        }\n        // eslint-disable-next-line no-unused-vars\n        var _b = this.props.imageDimensions || {}, marginLeft = _b.marginLeft, marginTop = _b.marginTop, restOfDimensions = __rest(_b, [\"marginLeft\", \"marginTop\"]);\n        var video = (React.createElement(\"div\", { className: baseClassName, \"data-hook\": \"video_container-video-player-element\", key: 'video_container-' + this.props.id, style: utils.deviceHasMemoryIssues() || this.state.ready\n                ? { backgroundColor: 'black' }\n                : __assign({ backgroundImage: \"url(\" + this.props.createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.HIGH_RES) + \")\" }, restOfDimensions) },\n            this.createPlayerElement(),\n            this.props.videoPlayButton));\n        return (React.createElement(\"div\", { key: 'video-and-hover-container' + this.props.idx }, [video, videoPlaceholder, hover]));\n    };\n    return VideoItem;\n}(GalleryComponent));\nexport default VideoItem;\n//# sourceMappingURL=videoItem.js.map","\"use strict\";\nmodule.exports = getStyle;\nfunction getStyle(isCrop, isWiderThenContainer) {\n    var CALC = 'calc(100% + 1px)';\n    return isCrop ? getCrop() : getNonCrop();\n    function getCrop() {\n        return {\n            height: isWiderThenContainer ? CALC : 'auto',\n            width: isWiderThenContainer ? 'auto' : CALC,\n            position: 'absolute',\n            margin: 'auto',\n            minHeight: '100%',\n            minWidth: '100%',\n            left: '-100%',\n            right: '-100%',\n            top: '-100%',\n            bottom: '-100%',\n        };\n    }\n    function getNonCrop() {\n        return {\n            width: isWiderThenContainer ? CALC : 'auto',\n            height: isWiderThenContainer ? '100%' : CALC,\n        };\n    }\n}\n//# sourceMappingURL=getStyle.js.map"],"sourceRoot":""}